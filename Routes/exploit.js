const express = require("express");
const gang = express.Router();
const path = require("path");
const fs = require("fs");
const log = require("../Other/log.js");

gang.use((req, res, next) => {
    if (req.path.includes('.env')) {
        let geekedip = req.headers['x-forwarded-for'] || req.connection.remoteAddress || req.socket.remoteAddress || req.connection.socket.remoteAddress;
        if (geekedip.includes('::ffff:')) {
            geekedip = geekedip.split('::ffff:')[1];
        }
        const logMessage = `retard tried to get env file for some reason, his ip is ${geekedip}\n`;
        const logFilePath = path.join(__dirname, '..', 'Logs', 'retards.log');
        fs.appendFileSync(logFilePath, logMessage);
        log.exploit(`${geekedip} tried to access the .env file, his attempt was blocked.`);
        return res.status(403).send(`bro i hav your ip!!! it is ${geekedip}!!! its logged in retards.log!!!`);
    }
    next();
});
module.exports = gang;